# Smart Traffic Control System - Quick Reference

## ğŸ“¦ Complete File Structure

```
traffic_control_system/
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py                   # Package initialization
â”‚   â”œâ”€â”€ data_generator.py             # Generates synthetic traffic data
â”‚   â”œâ”€â”€ etl_pipeline.py               # PySpark ETL processing
â”‚   â”œâ”€â”€ metrics_exporter.py           # Prometheus metrics server
â”‚   â””â”€â”€ gradio_ui.py                  # Gradio UI with Gemini AI
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                          # Generated by data_generator.py
â”‚   â”‚   â”œâ”€â”€ traffic_sensor_data.csv
â”‚   â”‚   â””â”€â”€ intersection_metadata.csv
â”‚   â””â”€â”€ processed/                    # Generated by etl_pipeline.py
â”‚       â”œâ”€â”€ enriched_data/
â”‚       â”œâ”€â”€ hourly_metrics/
â”‚       â””â”€â”€ intersection_stats/
â”‚
â”œâ”€â”€ requirements.txt                  # Python dependencies
â”œâ”€â”€ .env.example                      # Environment template
â”œâ”€â”€ .env                             # Your API keys (create this)
â”œâ”€â”€ .gitignore                       # Git ignore rules
â”œâ”€â”€ README.md                        # Main documentation
â””â”€â”€ installation-guide.md            # Detailed setup guide
```

---

## ğŸš€ Quick Start Commands

```bash
# 1. Setup
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt

# 2. Configure
cp .env.example .env
# Edit .env and add GEMINI_API_KEY

# 3. Generate Data
python src/data_generator.py

# 4. Process Data
python src/etl_pipeline.py

# 5. Launch UI
python src/gradio_ui.py

# 6. (Optional) Start Metrics
python src/metrics_exporter.py
```

---

## ğŸ”‘ Key Components

### 1. Data Generator (`data_generator.py`)
- **Purpose**: Create realistic synthetic traffic sensor data
- **Output**: CSV files with traffic metrics
- **Run Time**: ~30 seconds for 20 intersections, 24 hours

### 2. ETL Pipeline (`etl_pipeline.py`)
- **Purpose**: Process data using PySpark
- **Features**: 
  - Calculate Traffic Congestion Index (TCI)
  - Aggregate hourly metrics
  - Export to Parquet and CSV
- **Run Time**: ~2-3 minutes

### 3. Metrics Exporter (`metrics_exporter.py`)
- **Purpose**: Export metrics in Prometheus format
- **Port**: 8000
- **Update Interval**: 30 seconds

### 4. Gradio UI (`gradio_ui.py`)
- **Purpose**: Interactive interface with AI recommendations
- **Port**: 7860
- **Features**: Gemini AI integration for traffic decisions

---

## ğŸ“Š Traffic Congestion Index (TCI)

### Formula
```
TCI = min(100, (V/C) Ã— (1 - S/S_max) Ã— 100)

Where:
V = Vehicle count per 5 minutes
C = Road capacity per 5 minutes  
S = Current average speed
S_max = Free-flow speed (55 mph)
```

### Congestion Levels
- **Low** (0-20): Free flowing traffic
- **Moderate** (20-40): Smooth with minor delays
- **High** (40-60): Heavy traffic, significant delays
- **Severe** (60-80): Very slow, stop-and-go
- **Critical** (80-100): Gridlock conditions

---

## ğŸ¯ Access Points

| Service | URL | Login |
|---------|-----|-------|
| Gradio UI | http://localhost:7860 | None |
| Grafana | http://localhost:3000 | admin/admin |
| Prometheus Metrics | http://localhost:8000/metrics | None |

---

## ğŸ“ Common Tasks

### Regenerate Data with Different Parameters
```python
from src.data_generator import TrafficDataGenerator

# More intersections, longer timeframe
generator = TrafficDataGenerator(num_intersections=50, hours=48)
generator.save_to_csv()
```

### Query Processed Data
```python
import pandas as pd
import glob

# Read latest processed data
files = glob.glob("data/processed/intersection_stats_csv/*.csv")
df = pd.read_csv(files[0])

# Top 5 congested intersections
print(df.nlargest(5, 'avg_congestion_index'))
```

### Customize Gemini Prompt
Edit `src/gradio_ui.py`, modify the `context` variable in `generate_traffic_decision()`:
```python
context = f"""
Custom instructions for Gemini AI...
"""
```

---

## ğŸ› Quick Troubleshooting

### Problem: Java not found
```bash
# Install Java 11
sudo apt install openjdk-11-jdk  # Linux
brew install openjdk@11          # Mac

# Set JAVA_HOME
export JAVA_HOME=/path/to/java
```

### Problem: No data in Gradio
```bash
# Run ETL pipeline
python src/etl_pipeline.py

# Check files exist
ls data/processed/enriched_data_csv/
```

### Problem: Gemini API error
```bash
# Verify API key in .env
cat .env | grep GEMINI

# Test API key
python -c "import google.generativeai as genai; genai.configure(api_key='YOUR_KEY'); print('OK')"
```

### Problem: Port already in use
```bash
# Find and kill process
lsof -i :7860          # Mac/Linux
netstat -ano | findstr :7860  # Windows
kill -9 <PID>
```

---

## ğŸ“ˆ Grafana Dashboard Setup

### Quick Setup
1. Install Grafana: https://grafana.com/grafana/download
2. Start Grafana: `sudo systemctl start grafana-server`
3. Login: http://localhost:3000 (admin/admin)
4. Add CSV data source pointing to `data/processed/`
5. Create panels using hourly_metrics_csv and intersection_stats_csv

### Sample Panel Configurations

**Time Series - Congestion Over Time**
- Data: `hourly_metrics_csv/*.csv`
- X-axis: `hour`
- Y-axis: `avg_congestion_index`
- Type: Line chart

**Bar Chart - Top Congested Intersections**
- Data: `intersection_stats_csv/*.csv`
- X-axis: `location`
- Y-axis: `avg_congestion_index`
- Type: Bar chart

**Table - Intersection Stats**
- Data: `intersection_stats_csv/*.csv`
- Columns: intersection_id, location, avg_congestion_index, avg_speed
- Type: Table

---

## ğŸ”„ Development Workflow

### Daily Development
```bash
# 1. Activate environment
source venv/bin/activate

# 2. Make changes to code

# 3. Regenerate data if needed
python src/data_generator.py

# 4. Rerun ETL pipeline
python src/etl_pipeline.py

# 5. Test UI
python src/gradio_ui.py
```

### Adding New Features
1. Edit appropriate file in `src/`
2. Test locally
3. Update README.md if needed
4. Commit changes

---

## ğŸ“Š Sample Outputs

### Data Generator Output
```
Saved intersection metadata to data/raw/intersection_metadata.csv
Saved sensor data to data/raw/traffic_sensor_data.csv
Generated 5760 sensor readings for 20 intersections
```

### ETL Pipeline Output
```
============================================================
Starting Traffic ETL Pipeline
============================================================
Extracting data from data/raw/traffic_sensor_data.csv and data/raw/intersection_metadata.csv
Extracted 5760 sensor records
Extracted 20 intersection records
Starting transformation...
Transformation complete. Total records: 5760
Creating aggregated metrics...
...
ETL Pipeline Complete!
============================================================
```

### Gradio UI Output
```
Running on local URL:  http://0.0.0.0:7860
```

---

## ğŸ“ Learning Resources

### PySpark
- Official Docs: https://spark.apache.org/docs/latest/
- Tutorial: https://www.datacamp.com/tutorial/pyspark-tutorial-getting-started-with-pyspark

### Grafana
- Official Docs: https://grafana.com/docs/
- Getting Started: https://grafana.com/docs/grafana/latest/getting-started/

### Gemini API
- Documentation: https://ai.google.dev/docs
- Python SDK: https://github.com/google/generative-ai-python

### Gradio
- Official Docs: https://gradio.app/docs/
- Examples: https://gradio.app/demos/

---

## ğŸ’¡ Pro Tips

1. **Use Virtual Environment**: Always activate venv before running scripts
2. **Check Java**: PySpark requires Java 11+ to be installed
3. **Monitor Resources**: Large datasets may require more RAM
4. **Cache Results**: Use `.cache()` on frequently accessed DataFrames
5. **Test Incrementally**: Test each component separately before full integration
6. **Read Logs**: Check console output for error messages
7. **Version Control**: Use git to track changes
8. **Document Changes**: Update README when adding features

---

## ğŸ” Security Checklist

- [ ] `.env` file is in `.gitignore`
- [ ] API keys are not hardcoded
- [ ] Grafana default password changed
- [ ] File permissions are appropriate
- [ ] API rate limits understood
- [ ] No sensitive data in git repository

---

## ğŸ“± Contact & Support

For issues:
1. Check troubleshooting section
2. Review installation guide
3. Test components individually
4. Check log files

---

**System Status Checklist:**
- [ ] Java installed and in PATH
- [ ] Python 3.9+ installed
- [ ] Virtual environment activated
- [ ] Dependencies installed from requirements.txt
- [ ] .env file configured with GEMINI_API_KEY
- [ ] Data generated (CSV files in data/raw/)
- [ ] ETL pipeline run successfully
- [ ] Grafana installed and running
- [ ] Gradio UI accessible

---

**Ready to optimize traffic? Let's go! ğŸš¦ğŸš€**
